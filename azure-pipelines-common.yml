parameters:
  - name: name # defaults for any parameters that aren't specified
    default: ""
  - name: vmImage
    default: ""
  - name: serviceName
    type: string
    default: apc
    values:
      - apc
      - ji
  - name: deploy
    displayName: Deploy
    type: boolean
    default: false
  - name: vnetResourceGroup
    default: "dmsResourceGroup"
  - name: subscriptionId
    default: ""
  - name: tenantId
    default: ""
  - name: deploymentOperatorId
    default: "df461188-ee64-43bc-b888-0d2e4f55c9b1"
  - name: tags
    type: object
    default:
      BUSINESS-AREA: "spt"
      RUNTIME-ENVIRONMENT: "test"

  steps:
  - task: AzureCLI@2
    displayName: üß™ Test Common infrastructure
    inputs:
      azureSubscription: defaultAzureServiceConnection
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az --version
        az deployment sub create --what-if -f $(System.ArtifactsDirectory)/actions/bicep/Services/Common/infra.bicep --location westeurope --parameters @parameters.${{parameters.serviceName}}.json
  - task: AzureCLI@2
    displayName: üèó Deploy Common infrastructure
    condition: |
      and(
        succeeded('Build'), 
        eq(${{ parameters.deploy }}, true)
      )
    inputs:
      azureSubscription: defaultAzureServiceConnection
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az --version
        az deployment sub create -f $(System.ArtifactsDirectory)/actions/bicep/Services/Common/infra.bicep --location westeurope --parameters @parameters.${{parameters.serviceName}}.json
